<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<head>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<style>
	.details {
	position: fixed;
	top: 150px;
	left : 600px;
	border: none;
	background: #eeeeee;
	padding: 5px 5px 5px;
	width: 50%;
	height: 500px;
	text-align: left;
}
</style>

</head>

<body>
<!-- Create a div where the graph will take place -->
<div id="headerDiv">
	<center>
		<img id="spinner" src="svg/logogogo3.svg" height="100px">
		<br>Please Wait
	</center>
</div>
	
<div id="pathgraph">
</div>

<div class="details" >
	<center><h3>To Be Implemented</h3></center>
	<ul>
		<li>Show results of user interactions in this panel</li>
		<li>Put hydrolase reaction links on left of nodes - different color</li>
		<li>Render flippase and OST arcs as circles (special cases)</li>
		<li>Render nodes last so arcs are in background</li>
		<li>Mouse over accession - show SNFG image of accsssion here</li>
		<li>Click accession - link to its GlyGen record</li>
		<li>Mouse over arc - show reaction corresponding to arc here</li>
		<li>Click arc - new interactive page with reaction details for reaction corresponding to arc</li>
		<li>Mouse over node (already highlights arcs) - add highlight accession</li>
		<li>Automatically generate or allow user to select a single path* or collection of paths subsumed by the whole graph</li>
		<li>Click on node - force selected path* to pass through this node</li>
		<li>Button - show graph statistics - node, arc and unique path counts are already calculated by 'getPathD3v2.php'</li>
		<li>Button - toggle highlight arcs in selected path</li>
		<li>Button - render entire (selected) path here</li>
		<li>Button - generate most probable path</li>
		<li>Button - download entire graph as json</li>
		<li>Button - download selected path as json</li>
	</ul> 
</div>
	
<script>
var dataPath = "api/paths/getpathD3v2.php";
var arg = window.location.search.substring(1);
var a = arg.split("&");
var theURL = dataPath + "?start=" + a[1] + "&end=" +a[0];
// alert(theURL);
	
// graph dimensions and margins
// eventually, adjust the width and height cepending on nymber of nodes
var vSpacing = 20;

var col = ['coral', 'brown', 'forestgreen', 'dimgray', 'royalblue'];
// append the svg object to the body of the page

var margin = {top: 20, right: 30, bottom: 20, left: 30};
var width = 800 - margin.left - margin.right;
var height = 3000 - margin.top - margin.bottom;
	
var svg = d3.select("#pathgraph")
	.append("svg")
	.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform",
		 "translate(" + margin.left + "," + margin.top + ")");
	
// process data from API
d3.json(theURL, function( data) {
	document.getElementById("headerDiv").innerHTML = "<h2>Pathways from " + a[1] + " to " + a[0] + "</h2>"; 

  // List of node names
  var allNodes = data.nodes.map(function(d){return d.name})
  // path_count value
  var pc = data.path_count;
   
	var cc;
	var nodeCount = 0;
	data.nodes.forEach(function( d, i ) {
		nodeCount++;
		d.cc = col[d.dp % 5];
		d.y = vSpacing * nodeCount;
		console.log("name is " + d.name + "dp is " + d.dp + "  color is " + d.cc);
	});


  // draw nodes
  var nodes = svg
    .selectAll("danodes")
    .data(data.nodes)
    .enter()
    .append("circle")
      .attr("cx", 80)
      .attr("cy", function(d){ return(d.y)})
      .attr("r", 8)
  		// .style("fill", col[1])
  		.style("fill", function(d){ return(d.cc)})

  // label nodes
  var labels = svg
    .selectAll("dalabels")
    .data(data.nodes)
    .enter()
    .append("text")
      .attr("x", 20)
      .attr("y", function(d){ return(d.y+5)})
      .text(function(d){ return(d.name)})
      .style("text-anchor", "middle")
      .style("alignment-baseline", "middle")
 
  var count = svg
    .selectAll("dacount")
    .data(data.path_count)
    .enter()
/* the following does not work 
    .append("text")
      .attr("x", 40)
      .attr("y", 200)
      .text(function(d){ return d})
		.style("text-anchor", "middle")
      .style("alignment-baseline", "middle")
		.style("fill", "#000000")
		.style("font-size", "17px")
*/
  
	// draw links 
	// map each node to its id
	var node_id = {};
	data.nodes.forEach(function (n) {
	 node_id[n.id] = n;
	});
	
	var edgeCount = 0;
	data.links.forEach(function (n) {
		edgeCount++;
	});
	
	document.getElementById("headerDiv").innerHTML += "Number of nodes: " +  nodeCount + "; Number of links: " +  edgeCount + "; Number of unique paths: " + pc;

  // Add the links
  var links = svg
    .selectAll('mylinks')
    .data(data.links)
    .enter()
    .append('path')
    .attr('d', function (d) {
      // start = y(node_id[d.source].name)    // X position of start node on the X axis
      // end = y(node_id[d.target].name)      // X position of end node
		 start  = node_id[d.source].y
		 end  = node_id[d.target].y
      return ['M', 80, start,    
		// the arc starts at the starting node
        'A',                            
        (start - end), ',',    
		  // calculate the coordinates of the inflexion point. Its height is proportional to (start - end)
        0.6 * (start - end), 0, 0, ',',
			// Specify the direction of the arc: 1 -> right; 0 -> left
        start < end ? 1 : 0, 80, ',', end]
        .join(' ');
    })
    .style("fill", "none")
    .attr("stroke", "black")
	
    // Add the highlighting functionality
    nodes
      .on('mouseover', function (d) {
        // Highlight the connections to/from the node
        links
          .style('stroke', function (link_d) { return link_d.source === d.id || link_d.target === d.id ? '#69b3b2' : '#b8b8b8';})
          .style('stroke-width', function (link_d) { return link_d.source === d.id || link_d.target === d.id ? 4 : 1;})
      })
      .on('mouseout', function (d) {
        // nodes.style('fill', "#69b3a2")
        links
          .style('stroke', 'black')
          .style('stroke-width', '1')
      })
})

</script>
	
</body>